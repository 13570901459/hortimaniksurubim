<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Caixa - Enviar pedido para WhatsApp</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-2xl font-bold mb-4">Caixa — Registrar produto e enviar pedido por WhatsApp</h1>

    <!-- Registrar produto -->
    <section class="bg-white p-4 rounded-lg shadow mb-6">
      <h2 class="font-semibold mb-3">1) Registrar produto</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <input id="produtoNome" class="border p-2 rounded" placeholder="Nome (ex: Tomate)" />
        <input id="produtoPreco" class="border p-2 rounded" placeholder="Preço por kg (ex: 4.99)" inputmode="decimal" />
        <button id="btnAddProduto" class="bg-green-500 text-white px-4 py-2 rounded">Adicionar produto</button>
      </div>
      <p class="text-sm text-gray-500 mt-2">Os produtos adicionados ficam disponíveis no menu abaixo.</p>

      <ul id="listaProdutos" class="mt-3 space-y-2"></ul>
    </section>

    <!-- Caixa -->
    <section class="bg-white p-4 rounded-lg shadow mb-6">
      <h2 class="font-semibold mb-3">2) Registrar venda</h2>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-end">
        <div>
          <label class="block text-sm text-gray-600">Produto</label>
          <select id="selectProduto" class="border p-2 rounded w-full">
            <option value="">-- selecione --</option>
          </select>
        </div>
        <div>
          <label class="block text-sm text-gray-600">Quantidade (kg)</label>
          <input id="quantidade" type="number" step="0.01" min="0" class="border p-2 rounded w-full" placeholder="0.50" />
        </div>
        <div>
          <label class="block text-sm text-gray-600">Preço calculado</label>
          <div id="precoCalculado" class="border p-2 rounded">R$ 0,00</div>
        </div>
        <div>
          <button id="btnAdicionarCarrinho" class="bg-blue-600 text-white px-4 py-2 rounded w-full">Adicionar ao carrinho</button>
        </div>
      </div>

      <h3 class="mt-4 font-medium">Itens do carrinho</h3>
      <ul id="carrinho" class="mt-2 space-y-2"></ul>

      <div class="mt-4 flex justify-between items-center">
        <div>
          <label class="block text-sm text-gray-600">Telefone para WhatsApp (opcional, sem espaços, com DDD)</label>
          <input id="telefoneWhats" class="border p-2 rounded" placeholder="5581991234567 ou deixe vazio" />
        </div>
        <div class="text-right">
          <div class="text-sm text-gray-600">Total</div>
          <div id="total" class="text-xl font-bold">R$ 0,00</div>
        </div>
      </div>

      <div class="mt-4 flex gap-2">
        <button id="btnEnviarWhats" class="bg-green-600 text-white px-4 py-2 rounded">Enviar pedido por WhatsApp</button>
        <button id="btnLimpar" class="bg-gray-300 px-4 py-2 rounded">Limpar carrinho</button>
      </div>
    </section>

    <footer class="text-sm text-gray-500">Feito para Hortimanik — ajuste conforme precisar.</footer>
  </div>

  <script>
    // Estado
    const produtos = [];
    const carrinho = [];

    // Elementos
    const produtoNome = document.getElementById('produtoNome');
    const produtoPreco = document.getElementById('produtoPreco');
    const btnAddProduto = document.getElementById('btnAddProduto');
    const listaProdutos = document.getElementById('listaProdutos');

    const selectProduto = document.getElementById('selectProduto');
    const quantidadeInput = document.getElementById('quantidade');
    const precoCalculadoDiv = document.getElementById('precoCalculado');
    const btnAdicionarCarrinho = document.getElementById('btnAdicionarCarrinho');
    const carrinhoUL = document.getElementById('carrinho');
    const totalDiv = document.getElementById('total');
    const btnEnviarWhats = document.getElementById('btnEnviarWhats');
    const telefoneWhats = document.getElementById('telefoneWhats');
    const btnLimpar = document.getElementById('btnLimpar');

    // Helpers
    function formatBRL(valor){
      return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    function atualizarSelect(){
      selectProduto.innerHTML = '<option value="">-- selecione --</option>';
      produtos.forEach((p, idx) => {
        const opt = document.createElement('option');
        opt.value = idx;
        opt.textContent = `${p.nome} — ${formatBRL(p.precoPorKg)} / kg`;
        selectProduto.appendChild(opt);
      });
    }

    function renderListaProdutos(){
      listaProdutos.innerHTML = '';
      produtos.forEach((p, idx) => {
        const li = document.createElement('li');
        li.className = 'flex justify-between items-center border rounded p-2';
        li.innerHTML = `<div><strong>${p.nome}</strong><div class="text-sm text-gray-600">${formatBRL(p.precoPorKg)} / kg</div></div>
                        <div class="flex gap-2">
                          <button data-idx="${idx}" class="btnRemover bg-red-500 text-white px-2 py-1 rounded">Remover</button>
                        </div>`;
        listaProdutos.appendChild(li);
      });

      document.querySelectorAll('.btnRemover').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const idx = Number(e.currentTarget.dataset.idx);
          produtos.splice(idx,1);
          atualizarSelect();
          renderListaProdutos();
        });
      });
    }

    function atualizarPrecoCalculado(){
      const idx = selectProduto.value;
      const q = parseFloat(quantidadeInput.value || 0);
      if(idx === '' || isNaN(q) || q <= 0){
        precoCalculadoDiv.textContent = formatBRL(0);
        return;
      }
      const preco = produtos[idx].precoPorKg * q;
      precoCalculadoDiv.textContent = formatBRL(preco);
    }

    function renderCarrinho(){
      carrinhoUL.innerHTML = '';
      carrinho.forEach((item, i)=>{
        const li = document.createElement('li');
        li.className = 'flex justify-between items-center border rounded p-2';
        li.innerHTML = `<div>
                          <strong>${item.nome}</strong>
                          <div class="text-sm text-gray-600">${item.qtd} kg x ${formatBRL(item.precoPorKg)} / kg</div>
                        </div>
                        <div class="text-right">
                          <div>${formatBRL(item.subtotal)}</div>
                          <div class="flex gap-2 mt-2 justify-end">
                            <button data-i="${i}" class="btnRemoverItem text-sm bg-red-500 text-white px-2 py-1 rounded">Remover</button>
                          </div>
                        </div>`;
        carrinhoUL.appendChild(li);
      });

      document.querySelectorAll('.btnRemoverItem').forEach(b=>{
        b.addEventListener('click', (e)=>{
          const i = Number(e.currentTarget.dataset.i);
          carrinho.splice(i,1);
          atualizarTotal();
          renderCarrinho();
        });
      });

      atualizarTotal();
    }

    function atualizarTotal(){
      const total = carrinho.reduce((s, it)=> s + it.subtotal, 0);
      totalDiv.textContent = formatBRL(total);
    }

    // Eventos
    btnAddProduto.addEventListener('click', ()=>{
      const nome = produtoNome.value.trim();
      const preco = parseFloat(produtoPreco.value.replace(',', '.'));
      if(!nome || isNaN(preco) || preco <= 0){
        alert('Informe nome e preço válido (ex: 4.99)');
        return;
      }
      produtos.push({ nome, precoPorKg: preco });
      produtoNome.value = '';
      produtoPreco.value = '';
      atualizarSelect();
      renderListaProdutos();
    });

    selectProduto.addEventListener('change', atualizarPrecoCalculado);
    quantidadeInput.addEventListener('input', atualizarPrecoCalculado);

    btnAdicionarCarrinho.addEventListener('click', ()=>{
      const idx = selectProduto.value;
      const q = parseFloat(quantidadeInput.value || 0);
      if(idx === '' || isNaN(q) || q <= 0){
        alert('Selecione um produto e informe quantidade válida.');
        return;
      }
      const p = produtos[idx];
      const subtotal = +(p.precoPorKg * q);
      carrinho.push({ nome: p.nome, qtd: q, precoPorKg: p.precoPorKg, subtotal });
      quantidadeInput.value = '';
      precoCalculadoDiv.textContent = formatBRL(0);
      renderCarrinho();
    });

    btnLimpar.addEventListener('click', ()=>{
      if(confirm('Limpar o carrinho?')){
        carrinho.length = 0;
        renderCarrinho();
      }
    });

    btnEnviarWhats.addEventListener('click', ()=>{
      if(carrinho.length === 0){
        alert('Carrinho vazio. Adicione itens antes de enviar.');
        return;
      }
      const total = carrinho.reduce((s, it)=> s + it.subtotal, 0);
      let mensagem = 'Pedido%20Hortimanik%0A%0A';
      carrinho.forEach(it=>{
        const linha = `${it.nome} - ${it.qtd.toString().replace('.',',')}kg x R$ ${it.precoPorKg.toFixed(2).replace('.',',')} = R$ ${it.subtotal.toFixed(2).replace('.',',')}`;
        mensagem += encodeURIComponent(linha) + '%0A';
      });
      mensagem += '%0A' + encodeURIComponent('Total: R$ ' + total.toFixed(2).replace('.',','));

      const tel = telefoneWhats.value.trim();
      let url = '';
      if(tel){
        const apenasDigitos = tel.replace(/\D/g,'');
        url = `https://wa.me/${apenasDigitos}?text=${mensagem}`;
      } else {
        url = `https://wa.me/?text=${mensagem}`;
      }

      window.open(url, '_blank');
    });

    // Inicialização com os produtos fixos
    const produtosIniciais = [
      { nome: 'TOMATE PRIMEIRA', precoPorKg: 6.00 },
      { nome: 'CEBOLA PRIMEIRA', precoPorKg: 5.00 },
      { nome: 'BATATAINHA PRIMEIRA', precoPorKg: 5.00 },
      { nome: 'CENOURA PRIMEIRA', precoPorKg: 6.00 },
      { nome: 'UVA ITALIA', precoPorKg: 12.00 },
      { nome: 'UVA VITÓRIA', precoPorKg: 12.00 },
      { nome: 'MELÃO', precoPorKg: 5.00 },
      { nome: 'MANGA TOMY', precoPorKg: 2.50 },
      { nome: 'MANGA ESPADA', precoPorKg: 1.25 },
      { nome: 'MANGA ROSA', precoPorKg: 2.50 },
      { nome: 'MAMÃO FORMOSA', precoPorKg: 5.00 },
      { nome: 'MAÇÃ AGRANEL', precoPorKg: 1.00 },
      { nome: 'MAÇÃ NACIONAL', precoPorKg: 1.66 },
      { nome: 'PERA', precoPorKg: 2.50 },
      { nome: 'MACAXEIRA', precoPorKg: 5.00 },
      { nome: 'MAÇÃ FUJI', precoPorKg: 1.66 },
      { nome: 'MARACUJÁ', precoPorKg: 1.66 },
      { nome: 'LARANJA PERA', precoPorKg: 1.00 },
      { nome: 'LARANJA POKAM', precoPorKg: 1.25 },
      { nome: 'BATATA DOCE', precoPorKg: 4.00 },
      { nome: 'CARÁ', precoPorKg: 5.00 },
      { nome: 'ABACAXI', precoPorKg: 5.00 }
    ];

    produtos.push(...produtosIniciais);
    atualizarSelect();
    renderListaProdutos();
    renderCarrinho();
  </script>
</body>
</html>
p
