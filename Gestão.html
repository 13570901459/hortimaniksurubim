<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema PRO Hortifruti - Leandro</title>
    <style>
        :root { --primary: #2e7d32; --secondary: #1b5e20; --danger: #d32f2f; --info: #0277bd; --bg: #f0f2f5; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 10px; font-size: 14px; }
        .container { max-width: 1000px; margin: auto; }
        .card { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 15px; }
        h2 { color: var(--primary); margin-top: 0; border-bottom: 2px solid var(--primary); padding-bottom: 5px; }
        
        .grid-input { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; }
        .full { grid-column: span 1; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        
        button { cursor: pointer; border: none; border-radius: 4px; padding: 10px; font-weight: bold; color: white; }
        .btn-add { background: var(--primary); width: 100%; margin-top: 10px; font-size: 16px; }
        .btn-edit { background: var(--info); padding: 5px; margin-right: 5px; }
        .btn-del { background: var(--danger); padding: 5px; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #eee; }

        .relatorio-fornecedor { background: #fff; border-left: 6px solid var(--primary); padding: 10px; margin-bottom: 15px; }
        .item-detalhe { background: #f9f9f9; padding: 8px; margin: 5px 0; border-radius: 4px; border: 1px solid #eee; }
        .destaque { font-weight: bold; color: var(--secondary); }
        .resumo-total { background: #333; color: #fff; padding: 15px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2>ðŸ“¦ Entrada de Dados</h2>
        <div class="grid-input">
            <div><label>Fornecedor</label><input type="text" id="forn" placeholder="Ex: Tenente"></div>
            <div><label>Produto</label><input type="text" id="prod" placeholder="Ex: CarÃ¡"></div>
            <div><label>Custo Nota (R$)</label><input type="number" id="custo" placeholder="0.00"></div>
            <div><label>Qtd Comprada</label><input type="number" id="qtdC" placeholder="Ex: 30"></div>
            <div><label>Perda (%)</label><input type="number" id="perda" value="10"></div>
            <div>
                <label>Definir Venda por:</label>
                <select id="tipoVenda" onchange="alternarModoVenda()">
                    <option value="margem">Margem (%)</option>
                    <option value="valor">Valor Fixo (R$)</option>
                </select>
            </div>
            <div><label id="labelVenda">Margem (%)</label><input type="number" id="valorVenda" value="91"></div>
        </div>
        <button onclick="salvarProduto()" class="btn-add" id="btnSalvar">ADICIONAR PRODUTO</button>
    </div>

    <div class="card">
        <h2>ðŸ“‘ Itens na Lista</h2>
        <div style="overflow-x:auto;">
            <table id="tabela">
                <thead>
                    <tr>
                        <th>Fornecedor</th>
                        <th>Produto</th>
                        <th>Qtd</th>
                        <th>Custo Real</th>
                        <th>Venda</th>
                        <th>Margem</th>
                        <th>AÃ§Ãµes</th>
                    </tr>
                </thead>
                <tbody id="corpoTabela"></tbody>
            </table>
        </div>
    </div>

    <div id="areaRelatorio"></div>
</div>

<script>
    let produtos = [];
    let idEdicao = null;

    function alternarModoVenda() {
        const tipo = document.getElementById('tipoVenda').value;
        document.getElementById('labelVenda').innerText = tipo === 'margem' ? 'Margem (%)' : 'Valor de Venda (R$)';
    }

    function salvarProduto() {
        const f = document.getElementById('forn').value.toUpperCase();
        const p = document.getElementById('prod').value;
        const c = parseFloat(document.getElementById('custo').value);
        const qc = parseFloat(document.getElementById('qtdC').value);
        const per = parseFloat(document.getElementById('perda').value) / 100;
        const tipoV = document.getElementById('tipoVenda').value;
        const valV = parseFloat(document.getElementById('valorVenda').value);

        if(!f || !p || isNaN(c) || isNaN(qc)) return alert("Preencha os campos obrigatorios!");

        const vendavel = qc * (1 - per);
        const custoReal = c / vendavel; // Custo dividido pelo que sobrou
        
        let vendaFinal, margemFinal;

        if(tipoV === 'margem') {
            vendaFinal = Math.ceil(custoReal * (1 + (valV / 100))); // Arredondado
            margemFinal = valV;
        } else {
            vendaFinal = valV;
            margemFinal = ((vendaFinal / custoReal) - 1) * 100;
        }

        const faturamento = vendavel * vendaFinal;
        const lucro = faturamento - c;

        const obj = { id: idEdicao || Date.now(), forn: f, prod: p, custo: c, qtdC: qc, vendavel, custoReal, vendaFinal, margemFinal, faturamento, lucro, perdaPc: per*100 };

        if(idEdicao) {
            produtos = produtos.map(item => item.id === idEdicao ? obj : item);
            idEdicao = null;
            document.getElementById('btnSalvar').innerText = "ADICIONAR PRODUTO";
        } else {
            produtos.push(obj);
        }

        limpar();
        atualizar();
    }

    function editar(id) {
        const p = produtos.find(x => x.id === id);
        document.getElementById('forn').value = p.forn;
        document.getElementById('prod').value = p.prod;
        document.getElementById('custo').value = p.custo;
        document.getElementById('qtdC').value = p.qtdC;
        document.getElementById('perda').value = p.perdaPc;
        idEdicao = id;
        document.getElementById('btnSalvar').innerText = "ATUALIZAR PRODUTO";
        window.scrollTo(0,0);
    }

    function excluir(id) {
        produtos = produtos.filter(x => x.id !== id);
        atualizar();
    }

    function limpar() {
        document.getElementById('prod').value = '';
        document.getElementById('custo').value = '';
        document.getElementById('qtdC').value = '';
    }

    function atualizar() {
        const corpo = document.getElementById('corpoTabela');
        corpo.innerHTML = '';
        produtos.forEach(p => {
            corpo.innerHTML += `<tr>
                <td>${p.forn}</td>
                <td>${p.prod}</td>
                <td>${p.qtdC}</td>
                <td>R$ ${p.custoReal.toFixed(2)}</td>
                <td>R$ ${p.vendaFinal.toFixed(2)}</td>
                <td>${p.margemFinal.toFixed(0)}%</td>
                <td>
                    <button class="btn-edit" onclick="editar(${p.id})">Edit</button>
                    <button class="btn-del" onclick="excluir(${p.id})">X</button>
                </td>
            </tr>`;
        });

        renderRelatorio();
    }

    function renderRelatorio() {
        const area = document.getElementById('areaRelatorio');
        if(produtos.length === 0) { area.innerHTML = ''; return; }

        const forns = [...new Set(produtos.map(p => p.forn))];
        let html = '<h2>ðŸ“Š RELATÃ“RIO DE VENDAS</h2>';
        let totalInv = 0, totalFat = 0;

        forns.forEach(f => {
            const itens = produtos.filter(p => p.forn === f);
            let subCusto = 0;
            html += `<div class="relatorio-fornecedor"><h3>ðŸ§¾ Fornecedor: ${f}</h3>`;
            itens.forEach(i => {
                subCusto += i.custo;
                totalInv += i.custo;
                totalFat += i.faturamento;
                html += `<div class="item-detalhe">
                    <strong>${i.prod}</strong> | Compra: ${i.qtdC} | <span class="destaque">VendÃ¡vel: ${i.vendavel.toFixed(1)}</span><br>
                    Custo Real: R$ ${i.custoReal.toFixed(2)} | Venda: <span class="destaque">R$ ${i.vendaFinal.toFixed(2)}</span> (${i.margemFinal.toFixed(0)}% margem)<br>
                    Fat. Estimado: R$ ${i.faturamento.toFixed(2)} | Lucro: R$ ${i.lucro.toFixed(2)}
                </div>`;
            });
            html += `<strong>Total da Nota: R$ ${subCusto.toFixed(2)}</strong></div>`;
        });

        html += `<div class="resumo-total">
            <h3>ðŸ“ˆ RESUMO GERAL</h3>
            <p>Investimento: R$ ${totalInv.toFixed(2)}</p>
            <p>Venda Total: R$ ${totalFat.toFixed(2)}</p>
            <p style="font-size:20px">LUCRO ESTIMADO: R$ ${(totalFat - totalInv).toFixed(2)}</p>
        </div>`;

        area.innerHTML = html;
    }
</script>

</body>
</html>
