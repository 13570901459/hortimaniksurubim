<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hortifruti Leandro - Mobile Pro</title>
    <style>
        :root {
            --primary: #2e7d32;
            --secondary: #4caf50;
            --danger: #ef5350;
            --info: #29b6f6;
            --dark: #1b5e20;
            --bg: #f5f5f5;
        }

        /* Reset para Mobile */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; line-height: 1.5; }

        .container { max-width: 1100px; margin: auto; }
        
        header { text-align: center; padding: 15px 0; background: var(--primary); color: white; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        header h1 { margin: 0; font-size: 1.4rem; }

        .card { background: white; padding: 18px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 15px; border: 1px solid #eee; }
        h2 { font-size: 1.1rem; color: var(--dark); margin-top: 0; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; display: flex; align-items: center; gap: 8px; }

        /* Formul√°rio de Toque F√°cil */
        label { display: block; font-size: 0.85rem; font-weight: 700; color: #666; margin-bottom: 6px; margin-top: 12px; }
        input, select { 
            width: 100%; 
            padding: 14px; 
            border: 2px solid #e0e0e0; 
            border-radius: 10px; 
            font-size: 1rem; 
            background: #fff;
            transition: 0.2s;
        }
        input:focus { border-color: var(--primary); outline: none; background: #f1f8e9; }

        .row { display: flex; gap: 10px; }
        .row > div { flex: 1; }

        /* Bot√µes de A√ß√£o */
        .btn { 
            width: 100%; 
            padding: 16px; 
            border: none; 
            border-radius: 12px; 
            font-size: 1rem; 
            font-weight: 800; 
            text-transform: uppercase; 
            cursor: pointer; 
            transition: 0.3s;
            margin-top: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        .btn-add { background: var(--primary); color: white; }
        .btn-add:active { transform: scale(0.96); background: var(--dark); }
        .btn-clear { background: #9e9e9e; color: white; margin-top: 5px; }
        .btn-edit-mode { background: var(--info) !important; }

        /* Lista de Produtos (Visual de Card no Mobile) */
        .item-card { background: #fff; border: 1px solid #e0e0e0; border-radius: 12px; padding: 15px; margin-bottom: 10px; position: relative; }
        .item-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .item-forn { font-size: 0.75rem; background: #eee; padding: 2px 8px; border-radius: 4px; color: #666; font-weight: bold; }
        .item-name { font-size: 1.1rem; font-weight: bold; color: var(--dark); }
        
        .item-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem; margin-bottom: 10px; }
        .val { color: var(--primary); font-weight: bold; }
        
        .actions { display: flex; gap: 8px; border-top: 1px solid #f0f0f0; padding-top: 10px; }
        .btn-small { padding: 10px; flex: 1; border-radius: 8px; font-size: 0.85rem; color: white; text-align: center; text-decoration: none; }
        .b-edit { background: var(--info); }
        .b-del { background: var(--danger); }

        /* Resumo Geral fixo no fundo (Opcional) */
        .resumo-total { background: #263238; color: white; padding: 20px; border-radius: 15px; margin-top: 20px; }
        .resumo-line { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 1rem; }
        .resumo-destaque { font-size: 1.4rem; color: #00e676; font-weight: bold; border-top: 1px solid #455a64; padding-top: 10px; margin-top: 10px; }

        /* Ajustes para PC */
        @media (min-width: 768px) {
            .main-content { display: grid; grid-template-columns: 380px 1fr; gap: 20px; }
            .items-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üçè Hortifruti Leandro</h1>
    </header>

    <div class="main-content">
        <section class="card">
            <h2 id="formTitle">üìù Novo Produto</h2>
            <label>Fornecedor</label>
            <input type="text" id="forn" placeholder="Ex: TENENTE" autocomplete="off">
            
            <label>Nome do Produto</label>
            <input type="text" id="prod" placeholder="Ex: CAR√Å" autocomplete="off">
            
            <div class="row">
                <div>
                    <label>Custo Nota (R$)</label>
                    <input type="number" id="custo" placeholder="0.00" step="0.01" inputmode="decimal">
                </div>
                <div>
                    <label>Qtd na Nota</label>
                    <input type="number" id="qtdC" placeholder="30" inputmode="numeric">
                </div>
            </div>

            <div class="row">
                <div>
                    <label>Perda (%)</label>
                    <input type="number" id="perda" value="10" inputmode="numeric">
                </div>
                <div>
                    <label>Venda por:</label>
                    <select id="tipoVenda" onchange="mudarLabel()">
                        <option value="margem">Margem %</option>
                        <option value="valor">Pre√ßo R$</option>
                    </select>
                </div>
            </div>

            <label id="labelVenda">Margem de Lucro (%)</label>
            <input type="number" id="valorVenda" value="91" step="0.1" inputmode="decimal">

            <button onclick="salvar()" class="btn btn-add" id="btnSalvar">üöÄ Salvar Produto</button>
            <button onclick="limpar()" class="btn btn-clear">Limpar</button>
        </section>

        <section>
            <h2 style="padding-left: 10px;">üì¶ Mercadorias Lan√ßadas</h2>
            <div id="listaProdutos" class="items-list">
                </div>

            <div id="resumoGeral"></div>
        </section>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('leandro_horti_db')) || [];
    let editId = null;

    window.onload = atualizarTela;

    function mudarLabel() {
        const tipo = document.getElementById('tipoVenda').value;
        document.getElementById('labelVenda').innerText = tipo === 'margem' ? 'Margem de Lucro (%)' : 'Valor de Venda Direto (R$)';
    }

    function salvar() {
        const forn = document.getElementById('forn').value.toUpperCase();
        const prod = document.getElementById('prod').value.toUpperCase();
        const custo = parseFloat(document.getElementById('custo').value);
        const qtdC = parseFloat(document.getElementById('qtdC').value);
        const perda = parseFloat(document.getElementById('perda').value) / 100;
        const tipoV = document.getElementById('tipoVenda').value;
        const valorV = parseFloat(document.getElementById('valorVenda').value);

        if (!forn || !prod || isNaN(custo) || isNaN(qtdC)) {
            alert("Preencha os campos obrigat√≥rios!");
            return;
        }

        const vendavel = qtdC * (1 - perda);
        const custoReal = custo / vendavel;
        
        let vendaFinal, margemFinal;

        if (tipoV === 'margem') {
            vendaFinal = Math.ceil(custoReal * (1 + (valorV / 100)));
            margemFinal = valorV;
        } else {
            vendaFinal = valorV;
            margemFinal = ((vendaFinal / custoReal) - 1) * 100;
        }

        const faturamento = vendavel * vendaFinal;
        const lucro = faturamento - custo;

        const item = {
            id: editId || Date.now(),
            forn, prod, custo, qtdC, perdaPc: perda * 100,
            vendavel, custoReal, vendaFinal, margemFinal, faturamento, lucro
        };

        if (editId) {
            db = db.map(x => x.id === editId ? item : x);
            editId = null;
            document.getElementById('btnSalvar').classList.remove('btn-edit-mode');
            document.getElementById('formTitle').innerText = "üìù Novo Produto";
        } else {
            db.push(item);
        }

        localStorage.setItem('leandro_horti_db', JSON.stringify(db));
        limpar();
        atualizarTela();
    }

    function editar(id) {
        const item = db.find(x => x.id === id);
        document.getElementById('forn').value = item.forn;
        document.getElementById('prod').value = item.prod;
        document.getElementById('custo').value = item.custo;
        document.getElementById('qtdC').value = item.qtdC;
        document.getElementById('perda').value = item.perdaPc;
        editId = id;
        document.getElementById('btnSalvar').innerText = "üîÑ Atualizar Produto";
        document.getElementById('btnSalvar').classList.add('btn-edit-mode');
        document.getElementById('formTitle').innerText = "‚úèÔ∏è Editando Produto";
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function excluir(id) {
        if(confirm("Excluir este item?")) {
            db = db.filter(x => x.id !== id);
            localStorage.setItem('leandro_horti_db', JSON.stringify(db));
            atualizarTela();
        }
    }

    function limpar() {
        document.getElementById('prod').value = '';
        document.getElementById('custo').value = '';
        document.getElementById('qtdC').value = '';
        editId = null;
        document.getElementById('btnSalvar').innerText = "üöÄ Salvar Produto";
        document.getElementById('btnSalvar').classList.remove('btn-edit-mode');
        document.getElementById('formTitle').innerText = "üìù Novo Produto";
    }

    function atualizarTela() {
        const container = document.getElementById('listaProdutos');
        const resumo = document.getElementById('resumoGeral');
        container.innerHTML = '';
        
        let invTotal = 0;
        let fatTotal = 0;

        db.forEach(p => {
            invTotal += p.custo;
            fatTotal += p.faturamento;
            container.innerHTML += `
                <div class="item-card">
                    <div class="item-header">
                        <span class="item-name">${p.prod}</span>
                        <span class="item-forn">${p.forn}</span>
                    </div>
                    <div class="item-grid">
                        <div>Custo Real: <span class="val">R$ ${p.custoReal.toFixed(2)}</span></div>
                        <div>Venda: <span class="val">R$ ${p.vendaFinal.toFixed(2)}</span></div>
                        <div>Vend√°vel: <b>${p.vendavel.toFixed(1)}</b></div>
                        <div>Margem: <b>${p.margemFinal.toFixed(0)}%</b></div>
                    </div>
                    <div class="actions">
                        <div class="btn-small b-edit" onclick="editar(${p.id})">Editar</div>
                        <div class="btn-small b-del" onclick="excluir(${p.id})">Excluir</div>
                    </div>
                </div>
            `;
        });

        if(db.length > 0) {
            resumo.innerHTML = `
                <div class="resumo-total">
                    <div class="resumo-line"><span>Investimento:</span> <span>R$ ${invTotal.toFixed(2)}</span></div>
                    <div class="resumo-line"><span>Faturamento:</span> <span>R$ ${fatTotal.toFixed(2)}</span></div>
                    <div class="resumo-line resumo-destaque"><span>LUCRO:</span> <span>R$ ${(fatTotal - invTotal).toFixed(2)}</span></div>
                    <button class="btn" style="background:#546e7a; margin-top:20px;" onclick="window.print()">üñ®Ô∏è Imprimir Relat√≥rio</button>
                </div>
            `;
        } else {
            resumo.innerHTML = '';
        }
    }
</script>

</body>
</html>
