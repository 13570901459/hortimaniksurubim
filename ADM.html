<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Banca de Frutas</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    background: #0d1b2a;
    color: #f1f1f1;
  }
  header {
    background: #1b263b;
    padding: 15px;
    text-align: center;
    color: #fff;
    font-size: 22px;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,.3);
  }
  .container { max-width: 1200px; margin: auto; padding: 15px; }
  .card {
    background: #1e2a47;
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 10px;
    box-shadow: 0 3px 8px rgba(0,0,0,.4);
  }
  .card h3 { margin-top: 0; color: #90e0ef; }
  .card input {
    margin: 5px; padding: 8px; border-radius: 5px; border: none; outline: none; width: 150px;
  }
  button {
    margin: 5px; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;
  }
  .add-btn { background: #0077b6; color: white; }
  .print-btn { background: #00b4d8; color: white; }
  .edit-btn { background: #ffc107; color: #000; }
  .del-btn { background: #e63946; color: white; }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  th, td { border: 1px solid #33415c; padding: 8px; text-align: center; }
  th { background: #003566; color: #fff; }
  tfoot td { font-weight: bold; background: #001d3d; color: #fff; }
  /* responsivo */
  @media (max-width: 768px) {
    .card input { display: block; width: 100%; margin-bottom: 10px; }
    table, thead, tbody, th, td, tr { display: block; }
    thead tr { display: none; }
    tbody tr { margin-bottom: 15px; background: #14213d; border-radius: 6px; padding: 10px; }
    td { text-align: right; padding-left: 50%; position: relative; border: none; border-bottom: 1px solid #33415c; }
    td::before { content: attr(data-label); position: absolute; left: 10px; font-weight: bold; color: #90e0ef; }
  }
</style>
</head>
<body>
<header>
  <i class="fa-solid fa-store"></i> Controle da Banca de Frutas
</header>

<div class="container">

  <!-- Adicionar Produto -->
  <div class="card">
    <h3><i class="fa-solid fa-box"></i> Adicionar Produto</h3>
    <label>Produto: <input id="produto"></label>
    <label>Valor Caixa (R$): <input id="valor" type="number" step="0.01"></label>
    <label>Qtd Caixa: <input id="qtd" type="number" step="0.01"></label>
    <label>Margem (%): <input id="margem" type="number" step="0.01"></label>
    <label>Pre√ßo Venda Unit. (R$): <input id="venda" type="number" step="0.01"></label>
    <small style="color:#90e0ef;display:block;margin-top:5px;">
      üëâ Preencha <b>Margem %</b> ou <b>Pre√ßo de Venda</b>. Se preencher os dois, o Pre√ßo de Venda tem prioridade.
    </small>
    <button class="add-btn" onclick="adicionarProduto()"><i class="fa-solid fa-plus"></i> Adicionar</button>
  </div>

  <!-- Gastos -->
  <div class="card">
    <h3><i class="fa-solid fa-wallet"></i> Gastos Extras</h3>
    <label>Descri√ß√£o: <input id="descGasto"></label>
    <label>Valor (R$): <input id="valorGasto" type="number" step="0.01"></label>
    <button class="add-btn" onclick="adicionarGasto()"><i class="fa-solid fa-plus"></i> Adicionar Gasto</button>
    <table>
      <thead><tr><th>Descri√ß√£o</th><th>Valor</th><th>A√ß√µes</th></tr></thead>
      <tbody id="tabelaGastos"></tbody>
    </table>
  </div>

  <!-- Produtos -->
  <div class="card">
    <h3><i class="fa-solid fa-apple-whole"></i> Produtos</h3>
    <table>
      <thead>
        <tr>
          <th>Produto</th><th>Compra</th><th>Qtd</th><th>Custo Unit√°rio</th>
          <th>Margem</th><th>Venda Unit.</th><th>Lucro Unit.</th><th>Lucro Total</th><th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody id="tabelaProdutos"></tbody>
    </table>
  </div>

  <!-- Resumo -->
  <div class="card">
    <h3><i class="fa-solid fa-chart-line"></i> Resumo Final</h3>
    <table>
      <tfoot>
        <tr><td>Total Compras</td><td id="totalCompra">R$ 0,00</td></tr>
        <tr><td>Total Gastos</td><td id="totalGastos">R$ 0,00</td></tr>
        <tr><td>Lucro Bruto</td><td id="lucroBruto">R$ 0,00</td></tr>
        <tr><td>Lucro L√≠quido</td><td id="lucroLiquido">R$ 0,00</td></tr>
      </tfoot>
    </table>
    <button class="print-btn" onclick="window.print()"><i class="fa-solid fa-print"></i> Imprimir</button>
  </div>
</div>

<script>
let produtos = JSON.parse(localStorage.getItem("produtos")) || [];
let gastos = JSON.parse(localStorage.getItem("gastos")) || [];

function salvar() {
  localStorage.setItem("produtos", JSON.stringify(produtos));
  localStorage.setItem("gastos", JSON.stringify(gastos));
}
function formatar(valor) { return "R$ " + valor.toFixed(2).replace(".", ","); }

function atualizarTabelas() {
  let tabelaP = document.getElementById("tabelaProdutos");
  tabelaP.innerHTML = "";
  let totalCompra = 0, lucroBruto = 0;

  produtos.forEach((p,i) => {
    let tr = document.createElement("tr");
    tr.innerHTML = `
      <td data-label="Produto">${p.nome}</td>
      <td data-label="Compra">${formatar(p.valor)}</td>
      <td data-label="Qtd">${p.qtd}</td>
      <td data-label="Custo Unit.">${formatar(p.custo)}</td>
      <td data-label="Margem">${p.margem}%</td>
      <td data-label="Venda Unit.">${formatar(p.venda)}</td>
      <td data-label="Lucro Unit.">${formatar(p.venda - p.custo)}</td>
      <td data-label="Lucro Total">${formatar((p.venda - p.custo) * p.qtd)}</td>
      <td data-label="A√ß√µes">
        <button class="edit-btn" onclick="editarProduto(${i})"><i class="fa-solid fa-pen"></i></button>
        <button class="del-btn" onclick="excluirProduto(${i})"><i class="fa-solid fa-trash"></i></button>
      </td>`;
    tabelaP.appendChild(tr);
    totalCompra += p.valor;
    lucroBruto += (p.venda - p.custo) * p.qtd;
  });

  let tabelaG = document.getElementById("tabelaGastos");
  tabelaG.innerHTML = "";
  let totalGastos = 0;
  gastos.forEach((g,i) => {
    let tr = document.createElement("tr");
    tr.innerHTML = `<td data-label="Descri√ß√£o">${g.desc}</td>
      <td data-label="Valor">${formatar(g.valor)}</td>
      <td data-label="A√ß√µes"><button class="del-btn" onclick="excluirGasto(${i})"><i class="fa-solid fa-trash"></i></button></td>`;
    tabelaG.appendChild(tr);
    totalGastos += g.valor;
  });

  document.getElementById("totalCompra").textContent = formatar(totalCompra);
  document.getElementById("totalGastos").textContent = formatar(totalGastos);
  document.getElementById("lucroBruto").textContent = formatar(lucroBruto);
  document.getElementById("lucroLiquido").textContent = formatar(lucroBruto - totalGastos);
}

function adicionarProduto() {
  let nome = document.getElementById("produto").value;
  let valor = parseFloat(document.getElementById("valor").value);
  let qtd = parseFloat(document.getElementById("qtd").value);
  let margem = parseFloat(document.getElementById("margem").value);
  let vendaDigitada = parseFloat(document.getElementById("venda").value);

  if (!nome || !valor || !qtd) return alert("Preencha todos os campos obrigat√≥rios!");

  let custo = valor / qtd;
  let venda, margemFinal;

  if (!isNaN(vendaDigitada) && vendaDigitada > 0) {
    venda = vendaDigitada;
    margemFinal = ((venda / custo) - 1) * 100;
  } else if (!isNaN(margem) && margem > 0) {
    margemFinal = margem;
    venda = custo * (1 + margem/100);
  } else {
    return alert("Informe Margem (%) ou Pre√ßo de Venda!");
  }

  produtos.push({ nome, valor, qtd, custo, margem: margemFinal.toFixed(2), venda });
  salvar(); atualizarTabelas();

  document.getElementById("produto").value = "";
  document.getElementById("valor").value = "";
  document.getElementById("qtd").value = "";
  document.getElementById("margem").value = "";
  document.getElementById("venda").value = "";
}

function editarProduto(i) {
  let p = produtos[i];
  let novoNome = prompt("Nome:", p.nome);
  let novoValor = parseFloat(prompt("Valor da caixa:", p.valor));
  let novaQtd = parseFloat(prompt("Qtd caixa:", p.qtd));
  let novaMargem = prompt("Margem % (ou deixe em branco):", p.margem);
  let novoVenda = prompt("Pre√ßo de Venda Unit. (ou deixe em branco):", p.venda);

  if (!novoNome || !novoValor || !novaQtd) return;

  let custo = novoValor / novaQtd;
  let venda, margemFinal;

  if (novoVenda && !isNaN(parseFloat(novoVenda))) {
    venda = parseFloat(novoVenda);
    margemFinal = ((venda / custo) - 1) * 100;
  } else if (novaMargem && !isNaN(parseFloat(novaMargem))) {
    margemFinal = parseFloat(novaMargem);
    venda = custo * (1 + margemFinal/100);
  } else {
    alert("Informe Margem ou Pre√ßo de Venda!");
    return;
  }

  produtos[i] = { nome: novoNome, valor: novoValor, qtd: novaQtd, custo, margem: margemFinal.toFixed(2), venda };
  salvar(); atualizarTabelas();
}

function excluirProduto(i) {
  if (confirm("Excluir este produto?")) { produtos.splice(i,1); salvar(); atualizarTabelas(); }
}
function adicionarGasto() {
  let desc = document.getElementById("descGasto").value;
  let valor = parseFloat(document.getElementById("valorGasto").value);
  if (!desc || !valor) return alert("Preencha descri√ß√£o e valor!");
  gastos.push({ desc, valor });
  salvar(); atualizarTabelas();
  document.getElementById("descGasto").value = "";
  document.getElementById("valorGasto").value = "";
}
function excluirGasto(i) {
  if (confirm("Excluir este gasto?")) { gastos.splice(i,1); salvar(); atualizarTabelas(); }
}
atualizarTabelas();
</script>
</body>
</html>
